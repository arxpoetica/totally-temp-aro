<div class="modal" id="selected_location_controller" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <div class="selected-locations-header">
          <!-- The map that is shown in the header -->
          <img ng-attr-src="{{map_url}}">
          <!-- A div that is overlaid on the map image to make it appear darker -->
          <div class="selected-locations-map-overlay">
            <div class="selected-location-address">
              {{location.address}}
            </div>
            <div style="display:flex; width: 100%;">
              <div style="flex: 0 1 auto; padding: 10px;">
                <div class="selected-location-value">{{location.number_of_businesses}}</div>
                <div class="selected-location-label">Businesses</div>
              </div>
              <div style="flex: 0 1 auto; padding: 10px;">
                <div class="selected-location-value">{{location.number_of_households}}</div>
                <div class="selected-location-label">Households</div>
              </div>
              <div style="flex: 0 1 auto; padding: 10px;">
                <div class="selected-location-value">{{location.number_of_towers}}</div>
                <div class="selected-location-label">TODO Towers</div>
              </div>
              <div style="flex: 0 1 auto; padding: 10px;">
                <div class="selected-location-value">{{location.distance_to_client_fiber | number: 0}} m</div>
                <div class="selected-location-label">Distance from existing network</div>
              </div>
              <div style="flex: 1 1 auto; padding: 10px;">
                <div ng-if="location.distance_to_planned_network" class="selected-location-value">{{ location.distance_to_planned_network | number: 0 }} m</div>
                <div ng-if="!location.distance_to_planned_network" class="selected-location-value">No planned network</div>
                <div class="selected-location-label">Distance to planned network</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-body">
        <br>

        <ul class="nav nav-tabs" role="tablist">
          <!--
          <li role="presentation" ng-show="config.route_planning.length > 0">
            <a href="#selected_location_costs" aria-controls="home" role="tab" data-toggle="tab">Installation</a>
          </li>
          -->
          <li role="presentation" class="active">
            <a href="#selected_location_customer_profile" aria-controls="profile" role="tab" data-toggle="tab">Customer profile</a>
          </li>
          <% if (config.ui.locations_modal && config.ui.locations_modal.market_profile) { %>
          <li role="presentation">
            <a href="#selected_location_market_profile" aria-controls="profile" role="tab" data-toggle="tab">Market profile</a>
          </li>
          <% } %>
          <li role="presentation">
            <a href="#selected_location_fair_share" aria-controls="profile" role="tab" data-toggle="tab">Fair Share</a>
          </li>
          <li role="presentation">
            <a href="#selected_location_businesses" aria-controls="profile" role="tab" data-toggle="tab">Businesses</a>
          </li>
          <li role="presentation">
            <a href="#selected_location_households" aria-controls="profile" role="tab" data-toggle="tab">Households</a>
          </li>
          <li role="presentation">
            <a href="#selected_location_towers" aria-controls="profile" role="tab" data-toggle="tab">Cell Sites</a>
          </li>
        </ul>

        <div class="tab-content">
          <!--
          <div role="tabpanel" class="tab-pane" id="selected_location_costs" ng-show="config.route_planning">
            <table class="locations-table">
              <tbody>
                <tr>
                  <th>Entry fee</th>
                  <td colspan="2" class="text-right">N/A</td>
                </tr>
                <tr>
                  <th>Number of businesses</th>
                  <td colspan="2" class="text-right">{{location.number_of_businesses}}</td>
                </tr>
                <tr>
                  <th>Business install costs</th>
                  <td colspan="2" class="text-right">N/A</td>
                </tr>
                <tr ng-show="show_households">
                  <th>Number of households</th>
                  <td></td>
                  <td class="text-right">
                    <input type="text" class="form-control input-sm" style="text-align:right" ng-model="location.number_of_households">
                  </td>
                </tr>
                <tr ng-show="show_households">
                  <th>Household install costs</th>
                  <td colspan="2" class="text-right">N/A</td>
                </tr>
                <tr>
                  <th>Planned Fiber Strands</th>
                  <td colspan="2" class="text-right">N/A</td>
                </tr>
                <tr>
                  <th>Total costs</th>
                  <td colspan="2" class="text-right">N/A</td>
                </tr>
              </tbody>
            </table>
          </div>
          -->
          <div role="tabpanel" class="tab-pane active" id="selected_location_customer_profile">
            <div class="row" style="margin-top: 30px">
              <div class="col-md-4">
                <p class="text-center">Businesses</p>
                <div class="selected-location-empty-chart" ng-show="location.customer_profile_totals['businesses'] === 0">
                  No businesses at this location
                </div>
                <div ng-show="location.customer_profile_totals['businesses'] > 0">
                  <canvas id="location_customer_profile_chart_businesses" style="width:100%; height:200px"></canvas>
                  <div id="location_customer_profile_chart_legend_businesses"></div>
                </div>
              </div>
              <div class="col-md-4">
                <p class="text-center">Households</p>
                <div class="selected-location-empty-chart" ng-show="location.customer_profile_totals['households'] === 0">
                  No households at this location
                </div>
                <div ng-show="location.customer_profile_totals['households'] > 0">
                  <canvas id="location_customer_profile_chart_households" style="width:100%; height:200px"></canvas>
                  <div id="location_customer_profile_chart_legend_households"></div>
                </div>
              </div>
              <div class="col-md-4">
                <p class="text-center">Cell Sites</p>
                <div class="selected-location-empty-chart" ng-show="location.customer_profile_totals['towers'] === 0">
                  No TODOCELLT at this location
                </div>
                <div ng-show="location.customer_profile_totals['towers'] > 0">
                  <canvas id="location_customer_profile_chart_towers" style="width:100%; height:200px"></canvas>
                  <div id="location_customer_profile_chart_legend_towers"></div>
                </div>
              </div>
            </div>
          </div>
          <% if (config.ui.locations_modal && config.ui.locations_modal.market_profile) { %>
          <div role="tabpanel" class="tab-pane" id="selected_location_market_profile">
            <div class="row">
              <div class="col-md-6">
                <canvas id="location_market_size_chart" style="width:100%; height:200px"></canvas>
              </div>
              <div class="col-md-6">
                <form class="form-horizontal" style="margin-top: 30px">
                  <div class="form-group form-group-sm">
                    <label class="col-sm-3 control-label">Entity Type</label>
                    <div class="col-sm-9">
                      <select ng-model="entityType" ng-change="calculateMarketSize()" class="form-control">
                        <option value="businesses">Businesses</option>
                        <option value="households">Households</option>
                        <option value="towers">Cell Sites</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-group form-group-sm" ng-show="entityType === 'businesses'">
                    <label class="col-sm-3 control-label">Industry</label>
                    <div class="col-sm-9">
                      <select class="form-control" ng-options="industry.industry_name for industry in filters.industries" ng-model="industry" ng-change="calculateMarketSize()" multiple data-placeholder="All industries">
                      </select>
                    </div>
                  </div>
                  <div class="form-group form-group-sm" ng-show="entityType === 'businesses'">
                    <label class="col-sm-3 control-label">Product</label>
                    <div class="col-sm-9">
                      <select class="form-control" ng-options="product.product_name group by product.product_type for product in filters.products" ng-model="product" ng-change="calculateMarketSize()" multiple data-placeholder="All products">
                      </select>
                    </div>
                  </div>
                  <div class="form-group form-group-sm" ng-show="entityType === 'businesses'">
                    <label class="col-sm-3 control-label">Business size</label>
                    <div class="col-sm-9">
                      <select class="form-control" ng-options="range.value_range for range in filters.employees_by_location" ng-model="employees_range" ng-change="calculateMarketSize()" multiple data-placeholder="All business sizes">
                      </select>
                    </div>
                  </div>
                  <!--
                  <div class="form-group form-group-sm">
                    <label class="col-sm-3 control-label">Customer type</label>
                    <div class="col-sm-9">
                      <select class="form-control" ng-options="customer_type.name for customer_type in filters.customer_types" ng-model="customer_type" ng-change="calculateMarketSize()">
                        <option value="">Any customer type</option>
                      </select>
                    </div>
                  </div>
                  -->
                  <div class="form-group form-group-sm">
                    <div class="col-sm-9 col-sm-offset-3">
                      <p class="form-control-static" ng-show="!loading && market_size.length === 0">No data available for this location with the selected filters</p>
                      <p class="form-control-static" ng-show="loading">Loading...</p>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
          <% } %>
          <div role="tabpanel" class="tab-pane" id="selected_location_fair_share" style="margin-top:30px">
            <div class="row" style="margin-top: 30px">
              <div class="col-md-4">
                <p class="text-center">Businesses</p>
                <p class="text-center" style="margin-top: 60px" ng-show="fair_share['businesses'].length === 0">
                  <em>No businesses at this location</em>
                </p>
                <div ng-show="fair_share['businesses'].length > 0">
                  <canvas id="location_fair_share_chart_businesses" style="width:100%; height:200px"></canvas>
                  <div id="location_fair_share_chart_legend_businesses"></div>
                </div>
              </div>
              <div class="col-md-4">
                <p class="text-center">Households</p>
                <p class="text-center" style="margin-top: 60px" ng-show="fair_share['households'].length === 0">
                  <em>No households at this location</em>
                </p>
                <div ng-show="fair_share['households'].length > 0">
                  <canvas id="location_fair_share_chart_businesses" style="width:100%; height:200px"></canvas>
                  <div id="location_fair_share_chart_legend_businesses"></div>
                </div>
              </div>
              <div class="col-md-4">
                <p class="text-center">Cell Sites</p>
                <p class="text-center" style="margin-top: 60px" ng-show="fair_share['towers'].length === 0">
                  <em>No towers at this location</em>
                </p>
                <div ng-show="fair_share['towers'].length > 0">
                  <canvas id="location_fair_share_chart_businesses" style="width:100%; height:200px"></canvas>
                  <div id="location_fair_share_chart_legend_businesses"></div>
                </div>
              </div>
            </div>
          </div>
          <div role="tabpanel" class="tab-pane" id="selected_location_businesses">
            <table><tbody></tbody></table><!-- do not remove -->

            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Address</th>
                  <th class="text-right"><%- config.ui.locations_modal.countLabel %> Count</th>
                  <th class="text-right">Category</th>
                  <!--
                  <th class="text-right">Type</th>
                  -->
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="business in businesses">
                  <td ng-attr-id="location_business_row_{{ business.id }}"><a href="javascript:void(0)" ng-click="show_market_profile(business)">{{business.name}}</a></th>
                  <td>{{business.address}}</td>
                  <td class="text-right">{{business.number_of_employees}}</td>
                  <!--
                  <td class="text-right">
                    <span class="label label-success"
                      ng-attr-class="label label-{{business.customer_type.toLowerCase() === 'existing' ? 'success' : 'danger'}}">
                      {{business.customer_type}}
                    </span></td>
                  -->
                  <td class="text-right">{{business.size_name}}</td>
                </tr>
                <tr id="location_business_selected_info" style="display: none">
                  <td colspan="5">
                    <div class="row">
                      <div class="col-md-8">
                        <p ng-show="business_market_size && business_market_size.length === 0" class="text-center" style="margin-top: 30px">No data available for the selected business</p>
                        <canvas id="business_market_size_chart" style="width:100%; height:200px"></canvas>
                      </div>
                      <div class="col-md-4">
                        <form class="form-horizontal" style="margin-top: 30px">
                          <div class="form-group form-group-sm">
                            <label class="col-sm-3 control-label">Product</label>
                            <div class="col-sm-9">
                              <select class="form-control" ng-options="product.product_name group by product.product_type for product in filters.products"
                                ng-model="product" ng-change="calculate_business_market_size()" multiple data-placeholder="All products">
                              </select>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                  </td>
                </tr>
                <tr class="text-center" ng-show="businesses.length === 0">
                  <td style="padding: 40px" colspan="5">No businesses at this location</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div role="tabpanel" class="tab-pane" id="selected_location_households">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Address</th>
                  <th>Income Level</th>
                  <th>Education Level</th>
                  <th>Credit Quality</th>
                </tr>
              </thead>
              <tbody>
                <tr class="text-center" ng-show="households.length === 0">
                  <td style="padding: 40px" colspan="4">No households at this location</td>
                </tr>
                <tr ng-repeat="household in households">
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div role="tabpanel" class="tab-pane" id="selected_location_towers">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Site name</th>
                  <th>Address</th>
                  <th>Site type</th>
                  <th>Hub Name</th>
                </tr>
              </thead>
              <tbody>
                <tr class="text-center" ng-show="towers.length === 0">
                  <td style="padding: 40px" colspan="8">No cell sites at this location</td>
                </tr>
                <tr ng-repeat="tower in towers">
                  <td>Undefined</td>
                  <td>{{ tower.address || 'Undefined' }}</td>
                  <td>Undefined</td>
                  <td>Undefined</td>
                </tr>
              </tbody>
            </table>
          </div>

        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <!--
        <button type="button" class="btn btn-primary" ng-click="update()" ng-show="show_households">Update</button>
        <button type="button" class="btn btn-primary" ng-click="export()">Export</button>
        -->
      </div>
    </div>
  </div>
</div>
