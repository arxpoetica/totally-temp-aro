<!DOCTYPE html>
<html>
  <head>
    <title>ARO</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script>
      // Global variables
      var map;
      var county_subdivisions_layer = new google.maps.Data();
      var locations_layer = new google.maps.Data();
      var splice_points_layer = new google.maps.Data();

      // Available map layers (should be stored in config or controller eventually)
      var layer_properties = {
        county_subdivisions_layer: {
          visible: false,
          loaded: false
        },
        locations_layer: {
          visible: false,
          loaded: false
        },
        splice_points_layer: {
          visible: false,
          loaded: false
        }
      };

      // Folder for all map icons
      var map_icons_path = 'images/map_icons/';

      function initialize() {
        map = new google.maps.Map(document.getElementById('map-canvas'), {
          zoom: 7,
          center: {lat: 47.6097, lng: -122.3331}, // Centroid of Seattle, WA
          mapTypeId: google.maps.MapTypeId.HYBRID,
          panControl: false,
          zoomControlOptions: {
            style: google.maps.ZoomControlStyle.SMALL,
            position: google.maps.ControlPosition.TOP_LEFT
          },
          mapTypeControlOptions: {
            position: google.maps.ControlPosition.LEFT_TOP
          }
        });

        // Set up layer toggle control elements
        function MapLayerControls(controlDiv, map) {
          // County Subdivisions Control
          var county_control = document.createElement('div');
          county_control.style.backgroundColor = '#fff';
          county_control.style.border = '2px solid #000';
          county_control.style.borderRadius = '3px';
          county_control.style.boxShadow = '0 2px 6px rgba(0,0,0,.3)';
          county_control.style.cursor = 'pointer';
          county_control.style.marginBottom = '22px';
          county_control.style.marginRight = '10px';
          county_control.style.textAlign = 'center';
          county_control.title = 'County Subdivisions';
          controlDiv.appendChild(county_control);

          var county_control_text = document.createElement('div');
          county_control_text.style.color = 'rgb(25,25,25)';
          county_control_text.style.fontFamily = 'Roboto,Arial,sans-serif';
          county_control_text.style.fontSize = '12px';
          county_control_text.style.lineHeight = '38px';
          county_control_text.style.paddingLeft = '5px';
          county_control_text.style.paddingRight = '5px';
          county_control_text.innerHTML = 'CS';
          county_control.appendChild(county_control_text);

          google.maps.event.addDomListener(county_control, 'click', function() {
            toggle_layer(county_subdivisions_layer, 'county_subdivisions_layer', '/county_subdivisions/53', county_control);
          });

          // Locations Control
          var location_control = document.createElement('div');
          location_control.style.backgroundColor = '#fff';
          location_control.style.border = '2px solid #000';
          location_control.style.borderRadius = '3px';
          location_control.style.boxShadow = '0 2px 6px rgba(0,0,0,.3)';
          location_control.style.cursor = 'pointer';
          location_control.style.marginBottom = '22px';
          location_control.style.marginRight = '10px';
          location_control.style.textAlign = 'center';
          location_control.title = 'Locations';
          controlDiv.appendChild(location_control);

          var location_control_text = document.createElement('div');
          location_control_text.style.color = 'rgb(25,25,25)';
          location_control_text.style.fontFamily = 'Roboto,Arial,sans-serif';
          location_control_text.style.fontSize = '12px';
          location_control_text.style.lineHeight = '38px';
          location_control_text.style.paddingLeft = '5px';
          location_control_text.style.paddingRight = '5px';
          location_control_text.innerHTML = 'L';
          location_control.appendChild(location_control_text);

          google.maps.event.addDomListener(location_control, 'click', function() {
            toggle_layer(locations_layer, 'locations_layer', '/locations', location_control);
          });

          // Splice Points Control
          var splice_point_control = document.createElement('div');
          splice_point_control.style.backgroundColor = '#fff';
          splice_point_control.style.border = '2px solid #000';
          splice_point_control.style.borderRadius = '3px';
          splice_point_control.style.boxShadow = '0 2px 6px rgba(0,0,0,.3)';
          splice_point_control.style.cursor = 'pointer';
          splice_point_control.style.marginBottom = '22px';
          splice_point_control.style.marginRight = '10px';
          splice_point_control.style.textAlign = 'center';
          splice_point_control.title = 'Splice Points';
          controlDiv.appendChild(splice_point_control);

          var splice_point_control_text = document.createElement('div');
          splice_point_control_text.style.color = 'rgb(25,25,25)';
          splice_point_control_text.style.fontFamily = 'Roboto,Arial,sans-serif';
          splice_point_control_text.style.fontSize = '12px';
          splice_point_control_text.style.lineHeight = '38px';
          splice_point_control_text.style.paddingLeft = '5px';
          splice_point_control_text.style.paddingRight = '5px';
          splice_point_control_text.innerHTML = 'SP';
          splice_point_control.appendChild(splice_point_control_text);

          google.maps.event.addDomListener(splice_point_control, 'click', function() {
            toggle_layer(splice_points_layer, 'splice_points_layer', '/splice_points/VERIZON', splice_point_control);
          });
        }

        // Toggle map data layers
        //
        // layer: google.maps.Data() (ex. var my_layer = new google.maps.Data())
        // layer: String (ex. 'my_layer')
        // api_endpoint: String (ex. '/collection/:id')
        // control_element: document element (ex. var my_control = document.createElement('div'))
        function toggle_layer(layer, layer_name, api_endpoint, control_element) {
          if (!layer_properties[layer_name].visible) {
            // Load the layer's data if it's not already loaded
            // Should be cached eventually, not done like this
            if (!layer_properties[layer_name].loaded) {
              layer.loadGeoJson(api_endpoint);
              layer.setStyle(function(feature) {
                // If the layer has an icon property, this is the only style the layer gets
                if (feature.getProperty('icon')) {
                  var icon = feature.getProperty('icon');
                  return ({
                    icon: map_icons_path + icon
                  });
                // If they layer does not have an icon property, it needs to be styled
                } else {
                  var color = feature.getProperty('color');
                  return ({
                    fillColor: color,
                    strokeColor: color,
                    strokeWeight: 2
                  });
                }
              });
              layer_properties[layer_name].loaded = true;
            }
            layer.setMap(map);
            layer_properties[layer_name].visible = true;
            control_element.style.backgroundColor = '#f00';
          } else {
            layer.setMap(null)
            layer_properties[layer_name].visible = false;
            control_element.style.backgroundColor = '#fff';
          }
        }

        var mapLayerControlDiv = document.createElement('div');
        var mapLayerControl = new MapLayerControls(mapLayerControlDiv, map);

        mapLayerControlDiv.index = 1;
        map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(mapLayerControlDiv);

      }

      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
  </body>
</html>