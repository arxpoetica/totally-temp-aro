<!DOCTYPE html>
<html>
  <head>
    <title>ARO</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="stylesheets/aro.css">
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script>
      // Global variables
      var map;
      var county_subdivisions_layer = new google.maps.Data();
      var locations_layer = new google.maps.Data();
      var splice_points_layer = new google.maps.Data();

      // Available map layers (should be stored in config or controller eventually)
      var layer_properties = {
        county_subdivisions_layer: {
          visible: false,
          loaded: false
        },
        locations_layer: {
          visible: false,
          loaded: false
        },
        splice_points_layer: {
          visible: false,
          loaded: false
        }
      };

      // Folder for all map icons
      var map_icons_path = 'images/map_icons/';

      function initialize() {
        map = new google.maps.Map(document.getElementById('map-canvas'), {
          zoom: 7,
          center: {lat: 47.6097, lng: -122.3331}, // Centroid of Seattle, WA
          mapTypeId: google.maps.MapTypeId.HYBRID,
          panControl: false,
          zoomControlOptions: {
            style: google.maps.ZoomControlStyle.SMALL,
            position: google.maps.ControlPosition.TOP_RIGHT
          },
          mapTypeControlOptions: {
            position: google.maps.ControlPosition.TOP_RIGHT
          }
        });

        // Add Layer toggle listeners
        var county_control = document.getElementById('county_subdivisions_layer_toggle');

        google.maps.event.addDomListener(county_control, 'click', function() {
          toggle_layer(county_subdivisions_layer, 'county_subdivisions_layer', '/county_subdivisions/53', county_control);
        });

        var location_control = document.getElementById('locations_layer_toggle');

        google.maps.event.addDomListener(location_control, 'click', function() {
          toggle_layer(locations_layer, 'locations_layer', '/locations', location_control);
        });

        var splice_point_control = document.getElementById('splice_points_layer_toggle');

        google.maps.event.addDomListener(splice_point_control, 'click', function() {
          toggle_layer(splice_points_layer, 'splice_points_layer', '/splice_points/VERIZON', splice_point_control);
        });

        // Toggle map data layers
        //
        // layer: google.maps.Data() (ex. var my_layer = new google.maps.Data())
        // layer: String (ex. 'my_layer')
        // api_endpoint: String (ex. '/collection/:id')
        // control_element: document element (ex. var my_control = document.createElement('div'))
        function toggle_layer(layer, layer_name, api_endpoint, control_element) {
          if (!layer_properties[layer_name].visible) {
            // Load the layer's data if it's not already loaded
            // Should be cached eventually, not done like this
            if (!layer_properties[layer_name].loaded) {
              layer.loadGeoJson(api_endpoint);
              layer.setStyle(function(feature) {
                // If the layer has an icon property, this is the only style the layer gets
                if (feature.getProperty('icon')) {
                  var icon = feature.getProperty('icon');
                  return ({
                    icon: map_icons_path + icon
                  });
                // If they layer does not have an icon property, it needs to be styled
                } else {
                  var color = feature.getProperty('color');
                  return ({
                    fillColor: color,
                    strokeColor: color,
                    strokeWeight: 2
                  });
                }
              });
              layer_properties[layer_name].loaded = true;
            }
            layer.setMap(map);
            layer_properties[layer_name].visible = true;
            control_element.style.backgroundColor = '#f00';
          } else {
            layer.setMap(null)
            layer_properties[layer_name].visible = false;
            control_element.style.backgroundColor = '#fff';
          }
        }

        var mapLayerControlDiv = document.createElement('div');
        var mapLayerControl = new MapLayerControls(mapLayerControlDiv, map);
        mapLayerControlDiv.index = 1;
        map.controls[google.maps.ControlPosition.LEFT_TOP].push(mapLayerControlDiv);

        var mapToolControlDiv = document.createElement('div');
        var mapToolControl = new MapToolControls(mapToolControlDiv, map);
        mapToolControlDiv.index = 1;
        map.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(mapToolControlDiv);
      }

      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body>
      <div id="left-col">
        <div class="layer-toggle" id="county_subdivisions_layer_toggle">
          CS
        </div>
        <div class="layer-toggle" id="locations_layer_toggle">
          L
        </div>
        <div class="layer-toggle" id="splice_points_layer_toggle">
          SP
        </div>
        <hr />
        <div class="tool-toggle" id="shortest_path_optimizer_toggle">
          SPO
        </div>
      </div>
      <div id="map-canvas"></div>
    
  </body>
</html>