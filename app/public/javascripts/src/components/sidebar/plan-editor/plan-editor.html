<style>
  .edit-plan-container {
    position: absolute;
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
  }
  #tblEquipmentProperties td {
    line-height: 33px;  /* To vertically align text */
  }
  #tblBoundaryProperties td {
    line-height: 33px;  /* To vertically align text */
  }
  .drag-help-text.ng-hide-add {
    animation: fadeOutUp 300ms;
  }
  .drag-help-text.ng-hide-remove {
    animation: fadeInDown 300ms;
  }
  .draggable-item-button {
    border: none;
  }
  .plan-editor-hr {
    margin-top: 10px;
    margin-bottom: 10px;
  }
</style>

<div class="edit-plan-container">
  <accordion style="position: relative; flex: 1 1 auto;" toggle-expanded-panel="'EDIT_PLAN'">
    <accordion-panel-title title="'Edit Plan'" panel-id="'EDIT_PLAN'"></accordion-panel-title>
    <accordion-panel-contents panel-id="'EDIT_PLAN'">

      <!-- Add a component to handle map editing -->
      <map-object-editor map-global-object-name="{{$ctrl.mapGlobalObjectName}}"
                         map-container-id="map-canvas-container"
                         object-icon-url="/images/map_icons/aro/plan_equipment.png"
                         object-selected-icon-url="/images/map_icons/aro/plan_equipment_selected.png"
                         create-object-on-click="false"
                         on-create-object="$ctrl.handleObjectCreated(mapObject, usingMapClick)"
                         on-modify-object="$ctrl.handleObjectModified(mapObject)"
                         on-select-object="$ctrl.handleSelectedObjectChanged(mapObject)"
                         on-delete-object="$ctrl.handleObjectDeleted(mapObject)"
                         on-object-dropped-on-marker="$ctrl.handleObjectDroppedOnMarker({dropEvent: dropEvent, targetObjectId: targetObjectId})"
                         register-object-delete-callback="$ctrl.registerObjectDeleteCallback(deleteObjectWithId)"
                         register-create-map-objects-callback="$ctrl.registerCreateMapObjectsCallback(createMapObjects)"
                         register-remove-map-objects-callback="$ctrl.registerRemoveMapObjectsCallback(removeMapObjects)">
      </map-object-editor>

      <div style="margin: 10px">

        <!-- Buttons to commit or discard a transaction -->
        <div class="text-center">
          <div class="btn-group ">
            <button class="btn btn-default" ng-click="$ctrl.commitTransaction()"><i class="fa fa-check-circle"></i>&nbsp;&nbsp;Commit</button>
            <button class="btn btn-default" ng-click="$ctrl.discardTransaction()"><i class="fa fa-times-circle"></i>&nbsp;&nbsp;Discard</button>
          </div>
        </div>
        <br>

        <!-- Section that allows the user to drag and drop equipment and boundaries onto the map -->
        <div style="width: 100%">
          <div ng-show="$ctrl.showDragHelpText" class="drag-help-text">
            <p class="text-center">Click and drag equipment/boundary onto the map</p>
            <hr class="plan-editor-hr">
          </div>
          <!-- Equipment buttons. Only add the ones in the allEditableNetworkNodeTypes list -->
          <draggable-button ng-repeat="equipment in $ctrl.configuration.networkEquipment.equipments"
                            ng-if="$ctrl.allEditableNetworkNodeTypes.indexOf(equipment.networkNodeType) >= 0"
                            icon="{{equipment.iconUrl}}",
                            is-disabled="$ctrl.enabledNetworkNodeTypes.indexOf(equipment.networkNodeType) < 0"
                            entity-type="networkEquipment"
                            entity-details="{{equipment.networkNodeType}}">
          </draggable-button>
          <hr class="plan-editor-hr">
          <!-- Boundary buttons -->
          <div style="display: flex; flex-direction: row; width: 100%">
            <div style="flex: 0 0 auto">
              <draggable-button icon="/images/map_icons/aro/boundary_road_segments.png"
                                is-disabled="false"
                                is-boundary="true">
              </draggable-button>
            </div>
            <div style="flex: 0 0 auto">
              <draggable-button icon="/images/map_icons/aro/boundary_copper.png"
                                is-disabled="true"
                                is-boundary="true">
              </draggable-button>
            </div>
            <div style="flex: 0 0 auto; line-height: 45px; padding-left: 5px; padding-right: 5px;">
              Distance ({{$ctrl.configuration.units.length_units}})
            </div>
            <div style="flex: 1 1 auto; margin-top: 5px; padding-left: 5px; padding-right: 5px;">
              <input class="form-control"
                      ng-model="$ctrl.lastUsedBoundaryDistance">
            </div>
          </div>
        </div>

        <!-- Section to show properties when the selected map object is an equipment node -->
        <div ng-if="$ctrl.selectedMapObject && $ctrl.isMarker($ctrl.selectedMapObject)" style="margin-top: 10px">
          <!-- Section header showing the type of the selected object -->
          <div class="sidebar-table-header">
              <img ng-src="{{$ctrl.getSelectedNetworkConfig().iconUrl}}" style="vertical-align:middle; padding-right: 10px">
              <span>{{$ctrl.getSelectedNetworkConfig().label}}</span>
          </div>
          <!-- A table containing the editable properties of the selected object -->
          <table id="tblEquipmentProperties"
                 class="table table-condensed table-striped sidebar-table"
                 style="margin-bottom: 10px">
            <tbody>
              <tr>
                <td>Site Identifier</td>
                <td>
                  <input class="form-control"
                         ng-model="$ctrl.objectIdToProperties[$ctrl.selectedMapObject.objectId].siteIdentifier"
                         ng-change="$ctrl.markSelectedEquipmentPropertiesDirty()">
                </td>
              </tr>
              <tr>
                <td>Site Name</td>
                <td>
                  <input class="form-control"
                         ng-model="$ctrl.objectIdToProperties[$ctrl.selectedMapObject.objectId].siteName"
                         ng-change="$ctrl.markSelectedEquipmentPropertiesDirty()">
                </td>
              </tr>
              <tr>
                <td>Equipment</td>
                <td>
                  <select class="form-control"
                          ng-model="$ctrl.objectIdToProperties[$ctrl.selectedMapObject.objectId].selectedEquipmentType"
                          ng-options="item as item for item in $ctrl.objectIdToProperties[$ctrl.selectedMapObject.objectId].equipmentTypes"
                          ng-change="$ctrl.markSelectedEquipmentPropertiesDirty()">
                  </select>
                </td>
              </tr>
            </tbody>
          </table>
          <button ng-class="{ 'btn btn-sm pull-right': true,
                              'btn-default': !$ctrl.objectIdToProperties[$ctrl.selectedMapObject.objectId].isDirty,
                              'btn-primary': $ctrl.objectIdToProperties[$ctrl.selectedMapObject.objectId].isDirty }"
                  ng-disabled="!$ctrl.objectIdToProperties[$ctrl.selectedMapObject.objectId].isDirty"
                  ng-click="$ctrl.saveSelectedEquipmentProperties()"
                  style="margin-bottom: 10px">
            <i class="fa fa-save"></i>&nbsp;&nbsp;Save equipment properties
          </button>
        </div>

        <!-- Section to show properties when the selected map object is an equipment boundary -->
        <div ng-if="$ctrl.selectedMapObject && !$ctrl.isMarker($ctrl.selectedMapObject)" style="margin-top: 10px">
          <!-- Section header showing the type of the selected object -->
          <div class="sidebar-table-header">
              <img src="/images/map_icons/aro/boundary_road_segments.png" style="vertical-align:middle; padding-right: 10px">
              <span>Remote Terminal boundary</span>
          </div>
          <!-- A table containing the editable properties of the selected object -->
          <table id="tblBoundaryProperties"
                 class="table table-condensed table-striped sidebar-table"
                 style="margin-bottom: 10px">
            <tbody>
              <tr>
                <td>Site boundary type</td>
                <td>
                  <select class="form-control"
                          ng-model="$ctrl.objectIdToProperties[$ctrl.selectedMapObject.objectId].selectedSiteBoundaryTypeId"
                          ng-options="item.id as item.description for item in $ctrl.state.boundaryTypes"
                          ng-change="$ctrl.markSelectedBoundaryPropertiesDirty()">
                  </select>
                </td>
              </tr>
              <tr>
                <td>Site move update</td>
                <td>
                  <select class="form-control"
                          ng-model="$ctrl.objectIdToProperties[$ctrl.selectedMapObject.objectId].selectedSiteMoveUpdate"
                          ng-options="item as item for item in $ctrl.objectIdToProperties[$ctrl.selectedMapObject.objectId].siteMoveUpdates"
                          ng-change="$ctrl.markSelectedBoundaryPropertiesDirty()">
                  </select>
                </td>
              </tr>
              <tr>
                <td>Site boundary generation</td>
                <td>
                  <select class="form-control"
                          ng-model="$ctrl.objectIdToProperties[$ctrl.selectedMapObject.objectId].selectedSiteBoundaryGeneration"
                          ng-options="item as item for item in $ctrl.objectIdToProperties[$ctrl.selectedMapObject.objectId].siteBoundaryGenerations"
                          ng-change="$ctrl.markSelectedBoundaryPropertiesDirty()">
                  </select>
                </td>
              </tr>
            </tbody>
          </table>
          <button ng-class="{ 'btn btn-sm pull-right': true,
                              'btn-default': !$ctrl.objectIdToProperties[$ctrl.selectedMapObject.objectId].isDirty,
                              'btn-primary': $ctrl.objectIdToProperties[$ctrl.selectedMapObject.objectId].isDirty }"
                  ng-disabled="!$ctrl.objectIdToProperties[$ctrl.selectedMapObject.objectId].isDirty"
                  ng-click="$ctrl.saveSelectedBoundaryProperties()"
                  style="margin-bottom: 10px">
            <i class="fa fa-save"></i>&nbsp;&nbsp;Save boundary properties
          </button>
          <br>
        </div>
      </div>
    </accordion-panel-contents>
  </accordion>
</div>
