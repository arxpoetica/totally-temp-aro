<style>
  #tblEquipmentProperties td {
    line-height: 33px;  /* To vertically align text */
  }
  #tblBoundaryProperties td {
    line-height: 33px;  /* To vertically align text */
  }
  .draggable-item-button {
    border: none;
  }
  .plan-editor-hr {
    margin-top: 10px;
    margin-bottom: 10px;
  }
</style>

<div>
  <!-- Add a component to handle map editing -->
  <map-object-editor map-global-object-name="{{$ctrl.mapGlobalObjectName}}"
                    map-container-id="map-canvas-container"
                    get-object-icon-url="$ctrl.getObjectIconUrl({objectKey, objectValue})"
                    object-selected-icon-url="$ctrl.getObjectIconUrl({objectKey, objectValue})"
                    create-object-on-click="false"
                    
                    is-boundary-creation-allowed="$ctrl.isBoundaryCreationAllowed(mapObject)"
                    hide-object-ids="$ctrl.objectIdsToHide"
                    feature-type="equipment"
                    check-create-object="$ctrl.checkCanCreateObject(feature, usingMapClick)"
                    on-create-object="$ctrl.handleObjectCreated(mapObject, usingMapClick, feature, deleteExistingBoundary)"
                    on-modify-object="$ctrl.handleObjectModified(mapObject)"
                    on-select-object="$ctrl.handleSelectedObjectChanged(mapObject, isMult)"
                    on-delete-object="$ctrl.handleObjectDeleted(mapObject)"
                    display-view-object="$ctrl.displayViewObject(feature)"
                    display-edit-object="$ctrl.displayEditObject(feature, isMult)"
                    on-object-dropped-on-marker="$ctrl.handleObjectDroppedOnMarker({dropEvent: dropEvent, targetObjectId: targetObjectId})"
                    on-object-key-clicked="$ctrl.onMultiSelect(features, latLng)"
                    merge-selected-equipment="$ctrl.mergeMultiSelectGroup()"
                    register-object-delete-callback="$ctrl.registerObjectDeleteCallback(deleteObjectWithId)"
                    register-create-map-objects-callback="$ctrl.registerCreateMapObjectsCallback(createMapObjects)"
                    register-remove-map-objects-callback="$ctrl.registerRemoveMapObjectsCallback(removeMapObjects)"
                    register-create-editable-existing-map-object="$ctrl.registerCreateEditableExistingMapObject(createEditableExistingMapObject)"
                    register-delete-created-map-object="$ctrl.registerDeleteCreatedMapObject(deleteCreatedMapObject)"
                    register-select-proposed-feature="$ctrl.registerSelectProposedFeature(selectProposedFeature)"
                    register-map-object-from-event="$ctrl.registerMapObjectFromEvent(mapObjectFromEvent)"
                    register-highlight-map-object="$ctrl.registerHighlightMapObject(highlightMapObject)"
                    register-dehighlight-map-object="$ctrl.registerDehighlightMapObject(dehighlightMapObject)"
                    register-update-map-object-position="$ctrl.registerUpdateMapObjectPosition(updateMapObjectPosition)">
  </map-object-editor>
  <div style="margin: 10px;">

    <!-- Buttons to commit or discard a transaction -->
    <div class="text-center">
      <div class="btn-group ">
        <button class="btn btn-light" ng-click="$ctrl.commitTransaction($ctrl.currentTransaction.id)"><i class="fa fa-check-circle"></i>&nbsp;&nbsp;Commit</button>
        <button class="btn btn-light" ng-click="$ctrl.discardTransaction($ctrl.currentTransaction.id)"><i class="fa fa-times-circle"></i>&nbsp;&nbsp;Discard</button>
      </div>
    </div>
    <br>

    <!-- Section that allows the user to drag and drop equipment and boundaries onto the map -->
    <div style="width: 100%" ng-if="!$ctrl.isMultSelectActive()">
      <p class="text-center">Click and drag equipment/boundary onto the map</p>
      <hr class="plan-editor-hr">
      <!-- Equipment buttons. Only add the ones in the allEditableNetworkNodeTypes list -->
      <draggable-button ng-repeat="equipment in $ctrl.state.configuration.networkEquipment.equipments"
                        ng-if="$ctrl.allEditableNetworkNodeTypes.indexOf(equipment.networkNodeType) >= 0"
                        icon="{{equipment.iconUrl}}" 
                        is-disabled="false"
                        entity-type="networkEquipment"
                        entity-details="{{equipment.networkNodeType}}">
      </draggable-button>
      <hr class="plan-editor-hr">
      <!-- Boundary buttons -->
      <div ng-if="!$ctrl.state.showSiteBoundary" class="alert alert-warning">
        You can add site boundaries only if the "Site Boundaries" option is selected in View Settings
      </div>
      
      <div style="display: flex">
        <div style="flex: 0 0 auto; padding-right: 20px; line-height: 33px;">
          <input type="checkbox" class="checkboxfill" ng-checked="$ctrl.state.showSiteBoundary" ng-click="$ctrl.state.toggleSiteBoundary()" name="ctype-name"
            style="margin: 0px;">
            Site Boundaries
        </div>
        <select class="form-control" style="flex: 1 1 auto"
          ng-value="$ctrl.state.selectedBoundaryType.description"
          ng-if="$ctrl.state.showSiteBoundary" 
          ng-click="$ctrl.state.setSelectedBoundaryType($ctrl.state.boundaryTypes[$event.target.selectedIndex])">
          <option ng-repeat="item in $ctrl.state.boundaryTypes"
            ng-selected="{{ item.id === $ctrl.state.selectedBoundaryType.id }}"
            value="{{item.description}}">
            {{item.description}}
          </option>
        </select>
      </div>
      
      <div ng-if="$ctrl.state.showSiteBoundary" style="display: flex; flex-direction: row; width: 100%">
        <div style="flex: 0 0 auto">
          <draggable-button icon="/images/map_icons/aro/boundary_road_segments.png"
                            is-disabled="false"
                            is-boundary="true"
                            entity-details='{ "spatialEdgeType": "{{$ctrl.Constants.SPATIAL_EDGE_ROAD}}", "directed": false }'>
          </draggable-button>
        </div>
        <div style="flex: 0 0 auto">
          <draggable-button icon="/images/map_icons/aro/boundary_copper.png"
                            is-disabled="false"
                            is-boundary="true"
                            entity-details='{ "spatialEdgeType": "{{$ctrl.Constants.SPATIAL_EDGE_COPPER}}", "directed": false }'>
          </draggable-button>
        </div>
        <div style="flex: 0 0 auto">
          <draggable-button icon="/images/map_icons/aro/boundary_copper_directed.png"
                            is-disabled="false"
                            is-boundary="true"
                            entity-details='{ "spatialEdgeType": "{{$ctrl.Constants.SPATIAL_EDGE_COPPER}}", "directed": true }'>
          </draggable-button>
        </div>
        <div style="flex: 0 0 auto; line-height: 45px; padding-left: 5px; padding-right: 5px;">
          Distance ({{$ctrl.state.configuration.units.length_units}})
        </div>
        <div style="flex: 1 1 auto; margin-top: 5px; padding-left: 5px; padding-right: 5px;">
          <input class="form-control"
                  ng-model="$ctrl.lastUsedBoundaryDistance">
        </div>
      </div>
    </div>

    <!-- Section to show subnet calculation options -->
    <table id="tblPlanInfo" class="table table-sm table-striped" style="margin-top: 15px;">
      <tbody>
        <tr>
          <td>Fiber routing logic</td>
          <td>
            <input
              type="checkbox"
              class="checkboxfill layer-type-checkboxes"
              style="margin: 0px;"
              ng-model="$ctrl.autoRecalculateSubnet"
              ng-change="$ctrl.onAutoRecalculateSubnetChanged()">
              <span>Auto recalculate</span>
          </td>
          <td>
            <button
              ng-class="{ 'btn btn-sm float-right': true, 'btn-primary': !$ctrl.autoRecalculateSubnet, 'btn-light': $ctrl.autoRecalculateSubnet }"
              ng-disabled="$ctrl.autoRecalculateSubnet"
              ng-click="$ctrl.rebuildAllTransactionSubnets()">
              {{$ctrl.autoRecalculateSubnet ? 'Up-to date' : 'Calculate now'}}
            </button>
          </td>
        </tr>
        <tr>
          <td></td>
          <td colspan="2">
            <input type="checkbox" class="checkboxfill layer-type-checkboxes" style="margin: 0px;"
                  ng-model="$ctrl.stickyAssignment">
            <span>Sticky assignment</span>
          </td>
        </tr>
      </tbody>
    </table>
    
    
    <!-- Section for multi select actions -->
    <div class="clearfix" ng-if="$ctrl.selectedMapObject && $ctrl.isMarker($ctrl.selectedMapObject) && $ctrl.isMultSelectActive()" style="margin-top: 10px">
      <!-- Section header showing the type of the selected object -->
      <div class="sidebar-table-header" ng-if="$ctrl.getSelectedNetworkConfig()">
          <img ng-src="{{$ctrl.getSelectedNetworkConfig().iconUrl}}" style="vertical-align:middle; padding-right: 10px">
          <span>{{$ctrl.getSelectedNetworkConfig().label}}</span>
          <div class="sidebar-header-subinfo">
            <div class="sidebar-header-subinfo-item">lat: {{$ctrl.selectedMapObjectLat}}</div>
            <div class="sidebar-header-subinfo-item">long: {{$ctrl.selectedMapObjectLng}}</div>
          </div>
      </div>
      <div ng-if="$ctrl.getSelectedNetworkConfig().key === 'location_connector'" class="alert alert-warning" style="margin: 1rem 0 0 0">
        shift + click to select multiple Location Connectors
      </div>
      <div style="margin: 1rem 0 0 0">
        <button class="btn btn-danger float-right"
                ng-click="$ctrl.requestDeleteMultiSelectGroup()"
                style="margin-bottom: 10px">
          <i class="fa fa-trash-alt text-white"></i>&nbsp;&nbsp;Delete {{$ctrl.getMultiSelectCount()}}
        </button>
        <button class="btn btn-light float-right"
                ng-click="$ctrl.mergeMultiSelectGroup()"
                style="margin-bottom: 10px">
          <i class="fa fa-compress"></i>&nbsp;&nbsp;Merge {{$ctrl.getMultiSelectCount()}}
        </button>
      </div>
      <div>

      </div>
    </div>

    <!-- Section to show properties when the selected map object is an equipment node -->
    <equipment-properties-editor
      ng-if="!$ctrl.isMultSelectActive() && ($ctrl.selectedFeatures.length === 1) && ($ctrl.transactionFeatures[$ctrl.selectedFeatures[0]])"
      update-map-object-position="$ctrl.updateMapObjectPosition(objectId, lat, lng)">
    </equipment-properties-editor>


    <div ng-if="$ctrl.getSelectedNetworkConfig().key === 'location_connector'" class="alert alert-warning"
      style="margin: 1rem 0 0 0">
      right-click locations to toggle their connection
      <br>shift + click to select multiple Location Connectors
    </div>

    <boundary-properties-editor
      ng-if="!$ctrl.isMultSelectActive()"
      request-calculate-coverage="$ctrl.onRequestCalculateCoverage()">
    </boundary-properties-editor>
    <!-- Add a div that will overlay all the controls above. The div will be visible when the controls need to be disabled. -->
    <div class="disable-sibling-controls"
          ng-show="!$ctrl.currentTransaction || $ctrl.isCalculatingSubnets || $ctrl.isCreatingObject ||
          $ctrl.isModifyingObject || $ctrl.isCommittingTransaction">
    </div>
  </div>
</div>
