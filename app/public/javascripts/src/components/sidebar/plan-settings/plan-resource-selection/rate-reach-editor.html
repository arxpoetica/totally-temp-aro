<style scoped>
  #tblRateReachRatios td {
    line-height: 33px;
  }
  #rateReachSettings label {
    font-weight: 700;
  }
</style>

<modal-header title="{{$ctrl.rateReachManager.name + '  [' + $ctrl.categoryDescription[$ctrl.rateReachConfig.categoryType] + ']'}}"></modal-header>
<modal-body>
  <div class="container" style="max-height: 500px;">
    <div class="row">
      <div class="col-md-12">
        <form>
          <div class="form-group row">
            <label for="cboTechnologyTypes" class="col-md-4 col-form-label text-right" style="font-weight: 700;">Technology Type</label>
            <select id="cboTechnologyTypes"
                    class="form-control col-md-6"
                    ng-model="$ctrl.selectedTechnologyType"
                    ng-options="key as key for (key, value) in $ctrl.rateReachConfig.rateReachGroupMap">
            </select>
          </div>
        </form>
      </div>  
    </div>
    <div class="row">
      <!-- On the left, show dropdowns with the options that the user can edit -->
      <div class="col-md-3" style="overflow-y: auto;">
        <form id="rateReachSettings">
          <span class="ctype-checkbox" style="margin-right: 5px;">
            <input type="checkbox" class="checkboxfill" ng-style="stylebtn"
                   ng-model="$ctrl.rateReachConfig.rateReachGroupMap[$ctrl.selectedTechnologyType].active">
          </span>
          <label class="ctype-name">Enabled</label>

          <div style="position: relative; margin-top: 10px;">
            <div class="form-group">
              <label for="cboNetworkStructures">Network Connectivity</label>
              <select id="cboNetworkStructures"
                      class="form-control"
                      ng-model="$ctrl.rateReachConfig.rateReachGroupMap[$ctrl.selectedTechnologyType].networkStructure"
                      ng-options="item as item for item in $ctrl.technologyTypeDetails[$ctrl.selectedTechnologyType].networkStructures">
              </select>
            </div>
            <div class="disable-sibling-controls" ng-if="!$ctrl.rateReachConfig.rateReachGroupMap[$ctrl.selectedTechnologyType].active"></div>
          </div>
        </form>
      </div>

      <!-- On the right, show the details of the currently selected combination of category type, technology type, etc. -->
      <div class="col-md-9" style="overflow-y: auto;">
        <ul class="nav nav-tabs">
          <li class="nav-item">
            <a ng-class="{ 'nav-link': true, 'active': $ctrl.selectedEditingMode === $ctrl.editingModes.SPEEDS }"
              href="#"
              ng-click="$ctrl.selectedEditingMode = $ctrl.editingModes.SPEEDS">{{$ctrl.categoryDescription[$ctrl.rateReachConfig.categoryType]}}</a>
          </li>
          <li class="nav-item">
            <a ng-class="{ 'nav-link': true, 'active': $ctrl.selectedEditingMode === $ctrl.editingModes.RATE_REACH_RATIOS }"
              href="#"
              ng-click="$ctrl.selectedEditingMode = $ctrl.editingModes.RATE_REACH_RATIOS">Rate Reach Ratios</a>
          </li>
        </ul>

        <div ng-if="$ctrl.selectedEditingMode === $ctrl.editingModes.SPEEDS">
          <rate-reach-distance-editor
            category-type="$ctrl.rateReachConfig.categoryType"
            categories="$ctrl.rateReachConfig.categories"
            category-description="$ctrl.categoryDescription[$ctrl.rateReachConfig.categoryType]"
            rate-reach-group-map="$ctrl.rateReachConfig.rateReachGroupMap"
            technologies="$ctrl.technologyTypeDetails[$ctrl.selectedTechnologyType].technologies"
            selected-technology-type="$ctrl.selectedTechnologyType"
            allow-editable-categories="$ctrl.rateReachConfig.categoryType === 'SPEED'">
          </rate-reach-distance-editor>
        </div>
        <div ng-if="$ctrl.selectedEditingMode === $ctrl.editingModes.RATE_REACH_RATIOS">
          <table id="tblRateReachRatios" class="table table-sm table-borderless">
            <tr ng-repeat="(key, value) in $ctrl.rateReachConfig.marketAdjustmentFactorMap">
              <td>{{$ctrl.rateReachRatioDescription[key]}}</td>
              <td><input class="form-control" ng-model="$ctrl.rateReachConfig.marketAdjustmentFactorMap[key]"></td>
            </tr>
          </table>
        </div>
        <div class="disable-sibling-controls" ng-if="!$ctrl.rateReachConfig.rateReachGroupMap[$ctrl.selectedTechnologyType].active"></div>
      </div>
    </div>
  </div>

  <div style="text-align: right; padding-top: 15px; border-top: #ddd solid 1px;">
    <button class="btn btn-light" ng-click="$ctrl.exitEditingMode()">
      <i class="fa fa-undo action-button-icon"></i>Discard changes
    </button>
    <button class="btn btn-primary" ng-click="$ctrl.saveConfigurationToServer()">
      <i class="fa fa-save action-button-icon"></i>Save
    </button>
  </div>
</modal-body>
