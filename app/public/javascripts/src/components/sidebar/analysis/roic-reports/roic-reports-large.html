<style scoped>
  .roic-report-label {
    line-height: 33px;
  }
  .network-summary-card {
    border: 1px solid darkgray;
  }
  .card-row-1 {
    background-color: #e1ecff;
  }
  .card-row-2 {
    background-color: #f1fff1;
  }
  .card-row-3 {
    background-color: #ffecec;
  }
  .network-summary-card h5 {
    font-size: x-large;
  }
  #tblRoicReportsLargeSummary td {
    line-height: 33px; /* To vertically align text */
  }
  .indent-1 {
    padding-left: 30px !important;
  }
</style>

<div style="display: flex; flex-direction: column; height: 100%;">
  <div style="flex: 0 0 auto;">
    <form>
      <div class="form-group row">
        <div class="col-sm-2"></div>
        <div class="col-sm-2 roic-report-label">EntityType</div>
        <div class="col-sm-6">
          <select class="form-control"
                  ng-model="$ctrl.selectedEntityType"
                  ng-options="item as item.description for item in $ctrl.entityTypes">
          </select>
        </div>
        <div class="col-sm-2"></div>
      </div>
    </form>
  </div>
  <div style="flex: 0 0 auto;">
    <ul class="nav nav-tabs">
      <li class="nav-item" ng-repeat="category in $ctrl.categories">
        <a ng-class="{ 'nav-link': true, 'active': $ctrl.selectedCategory.id === category.id }"
            href="#" ng-click="$ctrl.selectCategory(category)">{{category.description}}</a>
      </li>
    </ul>
  </div>
  <!-- In "Summary" mode do not display graphs -->
  <div ng-if="$ctrl.selectedCategory.id === 'summary'" class="m-4" style="flex: 1 1 auto; position: relative; overflow-y: auto;">
    <div class="container">
      <table id="tblRoicReportsLargeSummary" class="table table-sm table-striped">
        <tbody>
          <tr ng-repeat="networkStatistic in $ctrl.roicResults.networkStatistics"
            ng-if="networkStatistic.networkStatisticType === 'roic_npv'">
            <td ng-if="networkStatistic.networkStatisticType === 'roic_npv'"><strong>NPV</strong></td>
            <td ng-if="networkStatistic.networkStatisticType === 'roic_npv'">
              {{networkStatistic.value / 1000 | currency:$ctrl.config.currency_symbol:1}} K
            </td>
          </tr>
          
          <tr ng-repeat="networkStatistic in $ctrl.roicResults.networkStatistics"
            ng-if="networkStatistic.networkStatisticType === 'roic_irr'">
            <td ng-if="networkStatistic.networkStatisticType === 'roic_irr'"><strong>IRR</strong></td>
            <td ng-if="networkStatistic.networkStatisticType === 'roic_irr'">
              {{(networkStatistic.value * 100) | number : 1}} %
            </td>
          </tr>
    
          <tr>
            <td><strong>Total Capex</strong></td>
            <td>{{$ctrl.roicResults.priceModel.totalCost / 1000 | currency:$ctrl.config.currency_symbol:1}}K</td>
          </tr>
    
          <tr>
            <td colspan="2"><strong>Fiber Capex</strong></td>
          </tr>
          <tr ng-repeat="fiberCost in $ctrl.roicResults.priceModel.fiberCosts">
            <td class="indent-1 text-capitalize">{{fiberCost.fiberType}} ({{fiberCost.lengthMeters * $ctrl.config.length.meters_to_length_units | number : 0}} {{$ctrl.config.length.length_units}})</td>
            <td>{{fiberCost.totalCost / 1000 | currency:$ctrl.config.currency_symbol:1}}K</td>
          </tr>
          <tr>
            <td colspan="2"><strong>Equipment Capex</strong></td>
          </tr>
          <tr ng-repeat="equipmentCost in $ctrl.roicResults.priceModel.equipmentCosts">
            <td class="indent-1 text-capitalize">{{$ctrl.state.configuration.networkEquipment.equipments[equipmentCost.nodeType].label || $ctrl.state.networkNodeTypesEntity[equipmentCost.nodeType]}} (x{{equipmentCost.quantity |Â number }})</td>
            <td>{{equipmentCost.total / 1000 | currency:$ctrl.config.currency_symbol:1}}K</td>
          </tr>
    
          <tr>
            <td>Premises Passed</td>
            <td> {{$ctrl.plannedNetworkDemand.locationDemand.rawCoverage | number}} </td>
          </tr>
          <tr ng-repeat="(key, value) in $ctrl.plannedNetworkDemand.locationDemand.entityDemands">
            <td class="indent-1 text-capitalize" ng-if="key === 'small' || key === 'medium' || key === 'large'"> {{key}} Business </th>
            <td class="indent-1 text-capitalize" ng-if="key === 'household' || key === 'celltower'"> {{key}} </th>  
            <td> {{value.rawCoverage | number}} </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Show the graphs section only if we are not in "Summary" mode -->
  <div ng-if="$ctrl.selectedCategory.id !== 'summary'"  style="flex: 1 1 auto; position: relative;">
    <div style="display:flex; flex-direction: column; position: absolute; width: 50%;height: 100%;">
      <div ng-repeat="calcType in $ctrl.selectedCategory.calcTypes" ng-if="$even" style="flex: 1 1 auto; width: 100%;">
        <div style="display: flex; flex-direction: column; width: 100%; height: 100%;">
          <h5 style="flex: 0 0 auto;" class="text-center mt-2">{{calcType.description}}</h5>
          <div style="flex: 1 1 auto;">
            <canvas ng-if="$ctrl.roicResults.roicAnalysis.components[$ctrl.selectedCategory.selectedNetworkType.toUpperCase()]
                            [$ctrl.selectedEntityType.id + '.' + calcType.id].values"
                    style="width: 100%; height: 100%;"
                    class="chart chart-line"
                    chart-data="$ctrl.roicResults.roicAnalysis.components[$ctrl.selectedCategory.selectedNetworkType.toUpperCase()]
                                [$ctrl.selectedEntityType.id + '.' + calcType.id].values"
                    chart-labels="$ctrl.timeLabels"
                    chart-series="$ctrl.series"
                    chart-options="$ctrl.graphOptions[calcType.id]"
                    chart-dataset-override="$ctrl.datasetOverride">
            </canvas>
            <div ng-if="!$ctrl.roicResults.roicAnalysis.components[$ctrl.selectedCategory.selectedNetworkType.toUpperCase()]
                        [$ctrl.selectedEntityType.id + '.' + calcType.id].values"
                 class="alert bg-light border-info text-center" style="margin: 0px 20%;">
              No data
            </div>
          </div>
        </div>
      </div>
    </div>
    <div style="display:flex; flex-direction: column; position: absolute; left: 50%; width: 50%;height: 100%;">
      <div ng-repeat="calcType in $ctrl.selectedCategory.calcTypes" ng-if="$odd" style="flex: 1 1 auto; width: 100%;">
        <div style="display: flex; flex-direction: column; width: 100%; height: 100%;">
          <h5 style="flex: 0 0 auto;" class="text-center mt-2">{{calcType.description}}</h5>
          <div style="flex: 1 1 auto;">
            <canvas ng-if="$ctrl.roicResults.roicAnalysis.components[$ctrl.selectedCategory.selectedNetworkType.toUpperCase()]
                          [$ctrl.selectedEntityType.id + '.' + calcType.id].values"
                  style="width: 100%; height: 100%;"
                  class="chart chart-line"
                  chart-data="$ctrl.roicResults.roicAnalysis.components[$ctrl.selectedCategory.selectedNetworkType.toUpperCase()]
                              [$ctrl.selectedEntityType.id + '.' + calcType.id].values"
                  chart-labels="$ctrl.timeLabels"
                  chart-series="$ctrl.series"
                  chart-options="$ctrl.graphOptions[calcType.id]"
                  chart-dataset-override="$ctrl.datasetOverride">
            </canvas>
            <div ng-if="!$ctrl.roicResults.roicAnalysis.components[$ctrl.selectedCategory.selectedNetworkType.toUpperCase()]
                        [$ctrl.selectedEntityType.id + '.' + calcType.id].values"
                 class="alert bg-light border-info text-center" style="margin: 0px 20%;">
              No data
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
